# Importing Existing GoDaddy Resources

This guide explains how to import existing GoDaddy domains and DNS records into Terraform using the GoDaddy provider.

## Prerequisites

- GoDaddy API credentials (Key and Secret)
- Terraform installed
- GoDaddy provider installed locally
- `curl` and `jq` for the shell script helper

## Import Methods

### Method 1: Using the Shell Script Helper (Recommended)

The provider includes a shell script that helps you discover and import existing resources.

#### Setup

```bash
# Make the script executable
chmod +x scripts/import-helper.sh

# Set your API credentials
export GODADDY_API_KEY="your-api-key"
export GODADDY_API_SECRET="your-api-secret"
export GODADDY_ENVIRONMENT="production"  # or "test"
```

#### Usage Examples

```bash
# List all DNS records for a domain
./scripts/import-helper.sh -d example.com

# Get domain information
./scripts/import-helper.sh -d example.com -t domain

# Generate complete Terraform configuration
./scripts/import-helper.sh -d example.com -t all > example.com.tf

# Use specific credentials
./scripts/import-helper.sh -d example.com -k YOUR_KEY -s YOUR_SECRET
```

#### Sample Output

```bash
$ ./scripts/import-helper.sh -d test.com

[INFO] GoDaddy Terraform Provider Import Helper
[INFO] Domain: test.com
[INFO] Resource Type: dns_record
[INFO] Environment: production

[INFO] Fetching DNS records for domain: test.com
[SUCCESS] Found 8 DNS records

TYPE   NAME                 DATA                                                 TTL      PRIORITY
----   ----                 ----                                                 ---      --------
A      @                    185.199.108.153                                     3600     
A      www                  185.199.108.153                                     3600     
CNAME  blog                 test.com                                      3600     
MX     @                    mail.test.com                                 3600     10      
TXT    @                    v=spf1 include:_spf.google.com ~all                 3600     

[INFO] To import a DNS record, use:
terraform import godaddy_dns_record.RESOURCE_NAME "test.com/TYPE/NAME/DATA"

[INFO] Or use the simplified format (auto-detect data for unique records):
terraform import godaddy_dns_record.RESOURCE_NAME "test.com/TYPE/NAME"

# Suggested import commands:
# terraform import godaddy_dns_record.root_a "test.com/A/@/185.199.108.153"
# terraform import godaddy_dns_record.www_a "test.com/A/www/185.199.108.153"
# terraform import godaddy_dns_record.blog_cname "test.com/CNAME/blog/test.com"
```

### Method 2: Using the Go Helper Tool

```bash
# Build the Go helper
go build -o import-helper ./cmd/import-helper

# List DNS records
./import-helper -domain example.com -type dns

# Generate Terraform config
./import-helper -domain example.com -type all -output terraform > example.com.tf

# Get domain info only
./import-helper -domain example.com -type domain -output table
```

### Method 3: Manual Import

If you know the specific resources you want to import:

#### Importing a Domain

```bash
# Import domain
terraform import godaddy_domain.example "example.com"
```

#### Importing DNS Records

```bash
# Full format: domain/type/name/data
terraform import godaddy_dns_record.www_a "example.com/A/www/192.0.2.1"

# Simplified format (auto-detect data for unique records)
terraform import godaddy_dns_record.www_a "example.com/A/www"
```

## Import ID Formats

### Domain Resources
- Format: `domain_name`
- Example: `"example.com"`

### DNS Record Resources
- Full format: `domain/type/name/data`
- Simplified format: `domain/type/name` (auto-detects data for unique records)
- Examples:
  - `"example.com/A/@/192.0.2.1"`
  - `"example.com/A/@"` (auto-detect)
  - `"example.com/CNAME/www/example.com"`
  - `"example.com/MX/@/mail.example.com"`

## Step-by-Step Import Process

### 1. Discover Existing Resources

```bash
# List all resources for a domain
./scripts/import-helper.sh -d example.com -t all
```

### 2. Generate Terraform Configuration

```bash
# Generate complete configuration
./scripts/import-helper.sh -d example.com -t all > example.com.tf
```

### 3. Review and Customize Configuration

Edit the generated `example.com.tf` file:
- Add your provider configuration
- Customize resource names
- Adjust settings as needed

### 4. Initialize Terraform

```bash
terraform init
```

### 5. Import Resources

Use the import commands generated by the helper script:

```bash
# Import domain
terraform import godaddy_domain.example_com "example.com"

# Import DNS records
terraform import godaddy_dns_record.root_a "example.com/A/@/192.0.2.1"
terraform import godaddy_dns_record.www_a "example.com/A/www/192.0.2.1"
terraform import godaddy_dns_record.blog_cname "example.com/CNAME/blog/example.com"
# ... more imports
```

### 6. Verify Import

```bash
# Check that resources are properly imported
terraform plan
```

The plan should show no changes if the import was successful and the configuration matches the actual resources.

## Common Import Scenarios

### Website with Standard DNS Setup

```bash
# A typical website might have:
terraform import godaddy_domain.mysite "mysite.com"
terraform import godaddy_dns_record.root_a "mysite.com/A/@/192.0.2.1"
terraform import godaddy_dns_record.www_a "mysite.com/A/www/192.0.2.1"
terraform import godaddy_dns_record.mail_mx "mysite.com/MX/@/mail.mysite.com"
```

### E-commerce Site with Multiple Services

```bash
# Complex setup with multiple subdomains
terraform import godaddy_domain.shop "shop.com"
terraform import godaddy_dns_record.root_a "shop.com/A/@/192.0.2.1"
terraform import godaddy_dns_record.www_cname "shop.com/CNAME/www/shop.com"
terraform import godaddy_dns_record.api_a "shop.com/A/api/192.0.2.2"
terraform import godaddy_dns_record.cdn_cname "shop.com/CNAME/cdn/cdn.provider.com"
terraform import godaddy_dns_record.mail_mx "shop.com/MX/@/mail.shop.com"
```

## Troubleshooting

### Import Fails with "Multiple DNS Records Found"

When using the simplified format (`domain/type/name`), if multiple records exist with the same type and name but different data values, you must use the full format:

```bash
# This fails if multiple A records exist for www
terraform import godaddy_dns_record.www_a "example.com/A/www"

# Use the full format instead
terraform import godaddy_dns_record.www_a "example.com/A/www/192.0.2.1"
```

### Import Fails with "No DNS Records Found"

The record might not exist, or there might be a DNS zone configuration issue:

1. Verify the domain uses GoDaddy DNS servers
2. Check the exact record name and type using the helper script
3. Ensure the domain has DNS records configured

### Import Fails with API Errors

Common API errors and solutions:

- **404 UNKNOWN_DOMAIN**: Domain doesn't have a DNS zone configured on GoDaddy
- **401 Unauthorized**: Check your API credentials
- **403 Forbidden**: API key doesn't have permission for this domain
- **429 Rate Limited**: Wait and retry

## Best Practices

1. **Always use the helper script first** to discover existing resources
2. **Generate Terraform configuration** before importing to ensure consistency
3. **Import domains before DNS records** to establish dependencies
4. **Test with `terraform plan`** after importing to verify correctness
5. **Use version control** to track your import process
6. **Document your import process** for team members

## Advanced Usage

### Bulk Import Multiple Domains

```bash
#!/bin/bash
domains=("example1.com" "example2.com" "example3.com")

for domain in "${domains[@]}"; do
    echo "Processing $domain..."
    ./scripts/import-helper.sh -d "$domain" -t all > "${domain}.tf"
    # Add manual import commands here
done
```

### Selective Import

You can choose to import only specific resources:

```bash
# Import only the domain, not DNS records
./scripts/import-helper.sh -d example.com -t domain

# Import only specific DNS record types
./scripts/import-helper.sh -d example.com -t dns | grep "TYPE A"
```

## Security Considerations

- Never commit API credentials to version control
- Use environment variables or Terraform Cloud/Enterprise for credential management
- Regularly rotate API keys
- Use the test environment for development and testing
- Review generated configurations before applying changes

## Support

For issues with importing:

1. Check the [troubleshooting section](#troubleshooting)
2. Verify your API credentials and permissions
3. Test with the GoDaddy API directly using curl
4. Check the provider logs with `TF_LOG=DEBUG`
5. Open an issue on the provider repository with full error details